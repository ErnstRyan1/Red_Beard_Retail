#perl

#This script is for batch exporting of meshes to modo mesh presets.  Just select a bunch of meshes and run this script

#SETUP USER VALUES
#userValueTools("sen_meshPresetExportPath",string,config,"Mesh preset export path","","","",xxx,xxx,"","");
#my $path = lxq("user.value sen_meshPresetExportPath ?");

#pick a filename to export to:
my @filePaths = fileDialog("save","Export mesh presets as:","*.lxl","lxl");
my $filePath = $filePaths[0];
$_ = $filePath;
my ($number) = /([0-9]*\.[a-z]+)/;
$number =~ s/[^0-9]//g;
if ($number == 0){	$number = 1;	lxout("A number wasn't found in the filename so i'm starting at 1 in the save indices");} 
$filePath =~ s/[0-9]*\.lxl//;

#go through all selected meshes and export them out as modo presets
my @meshIDs = lxq("query sceneservice selection ? mesh");
foreach my $id (@meshIDs){
	my $fileName = $filePath . $number . ".lxl";
	lx("!!select.subItem {$id} set mesh;camera;light;txtrLocator;backdrop;groupLocator;replicator;surfGen;locator;deform;locdeform;deformGroup;deformMDD2;morphDeform;itemInfluence;genInfluence;deform.wrap;softLag;modSculpt;ABCCurvesDeform.sample;ABCdeform.sample;defaultShader;defaultShader 0 0");
	if (-e $fileName){
		my $answer = popupReturnAnswer("$fileName already exists.  Do you wish to overwrite?");
		if ($answer == 1){	lx("item.presetStore mask:{mesh} filename:{$fileName}");	}
	}else{
		lx("item.presetStore mask:{mesh} filename:{$fileName}");
	}
	
	$number++;
}





#=====================================================================================================================================================================================================================
#=====================================================================================================================================================================================================================
#=====================================================================================================================================================================================================================
#=====================================================================================================================================================================================================================
#=====================================================================================================================================================================================================================
#=====================================================================================================================================================================================================================
#=====================================================================================================================================================================================================================
#=====================================================================================================================================================================================================================
#===															 SUBROUTINES										          ========================================================================================
#=====================================================================================================================================================================================================================
#=====================================================================================================================================================================================================================
#=====================================================================================================================================================================================================================
#=====================================================================================================================================================================================================================
#=====================================================================================================================================================================================================================
#=====================================================================================================================================================================================================================
#=====================================================================================================================================================================================================================
#=====================================================================================================================================================================================================================

#------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------
#POPUP RETURN ANSWER SUB
#------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------
#USAGE : my $answer = popupReturnAnswer("Do you want to do blah blah blah?");
sub popupReturnAnswer{
	lx("dialog.setup yesNo");
	lx("dialog.msg {@_}");
	lx("dialog.open");
	my $confirm = lxq("dialog.result ?");
	if($confirm eq "yes"){return 1;}else{return 0;}
}

#------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------
#POPUP SUB
#------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------
#USAGE : popup("What I wanna print");
sub popup #(MODO2 FIX)
{
	lx("dialog.setup yesNo");
	lx("dialog.msg {@_}");
	lx("dialog.open");
	my $confirm = lxq("dialog.result ?");
	if($confirm eq "no"){die;}
}

##------------------------------------------------------------------------------------------------------------
##------------------------------------------------------------------------------------------------------------
#FILE DIALOG WINDOW SUB
##------------------------------------------------------------------------------------------------------------
##------------------------------------------------------------------------------------------------------------
##USAGE : my @files = fileDialog("open"|"save","title","*.lxo;*.lwo;*.obj","lxo");
##0=open or save #1=title #2=loadExt #3=saveExt
sub fileDialog{
	if ($_[0] eq "open")	{	lx("dialog.setup fileOpenMulti");	}
	else					{	lx("dialog.setup fileSave");		}

	lx("dialog.title {$_[1]}");
	lx("dialog.fileTypeCustom format:[stp] username:[$_[1]] loadPattern:[$_[2]] saveExtension:[$_[3]]");
	lx("dialog.open");
	my @fileNames = lxq("dialog.result ?") or die("The file saver window was cancelled, so I'm cancelling the script.");
	return (@fileNames);
}

#------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------
#SET UP THE USER VALUE OR VALIDATE IT   (no popups)
#------------------------------------------------------------------------------------------------------------
#------------------------------------------------------------------------------------------------------------
#userValueTools(name,type,life,username,list,listnames,argtype,min,max,action,value);
sub userValueTools{
	if (lxq("query scriptsysservice userValue.isdefined ? @_[0]") == 0){
		lxout("Setting up @_[0]--------------------------");
		lxout("Setting up @_[0]--------------------------");
		lxout("0=@_[0],1=@_[1],2=@_[2],3=@_[3],4=@_[4],5=@_[6],6=@_[6],7=@_[7],8=@_[8],9=@_[9],10=@_[10]");
		lxout("@_[0] didn't exist yet so I'm creating it.");
		lx( "user.defNew name:[@_[0]] type:[@_[1]] life:[@_[2]]");
		if (@_[3] ne "")	{	lxout("running user value setup 3");	lx("user.def [@_[0]] username [@_[3]]");	}
		if (@_[4] ne "")	{	lxout("running user value setup 4");	lx("user.def [@_[0]] list [@_[4]]");		}
		if (@_[5] ne "")	{	lxout("running user value setup 5");	lx("user.def [@_[0]] listnames [@_[5]]");	}
		if (@_[6] ne "")	{	lxout("running user value setup 6");	lx("user.def [@_[0]] argtype [@_[6]]");		}
		if (@_[7] ne "xxx")	{	lxout("running user value setup 7");	lx("user.def [@_[0]] min @_[7]");			}
		if (@_[8] ne "xxx")	{	lxout("running user value setup 8");	lx("user.def [@_[0]] max @_[8]");			}
		if (@_[9] ne "")	{	lxout("running user value setup 9");	lx("user.def [@_[0]] action [@_[9]]");		}
		if (@_[1] eq "string"){
			if (@_[10] eq ""){lxout("woah.  there's no value in the userVal sub!");							}		}
		elsif (@_[10] == ""){lxout("woah.  there's no value in the userVal sub!");									}
								lx("user.value [@_[0]] [@_[10]]");		lxout("running user value setup 10");
	}else{
		#STRING-------------
		if (@_[1] eq "string"){
			if (lxq("user.value @_[0] ?") eq ""){
				lxout("user value @_[0] was a blank string");
				lx("user.value [@_[0]] [@_[10]]");
			}
		}
		#BOOLEAN------------
		elsif (@_[1] eq "boolean"){

		}
		#LIST---------------
		elsif (@_[4] ne ""){
			if (lxq("user.value @_[0] ?") == -1){
				lxout("user value @_[0] was a blank list");
				lx("user.value [@_[0]] [@_[10]]");
			}
		}
		#ALL OTHER TYPES----
		elsif (lxq("user.value @_[0] ?") == ""){
			lxout("user value @_[0] was a blank number");
			lx("user.value [@_[0]] [@_[10]]");
		}
	}
}

